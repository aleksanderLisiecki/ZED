---
title: "projekt_ZED"
author: "Aleksander Lisiecki"
date: "20 11 2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Użyte biblioteki

```{r, message=FALSE}
library(dplyr)
library(plotly)
library(ggplot2)
library(readxl)
library(tidyr)
```

***

> ### Gold Prices

#### Wczytywanie i czyszczenie danych:

* nadanie właściwych typów danych,
* pozostawienie do dalszych rozważań jedynie ceny w walucie USD,
* zmiana nazw kolumn dla AM and PM fixing,

```{r, cache=TRUE}
Gold.prices <- read.csv("C:/Users/alili/Desktop/studia/9 semestr/ZED/projekt/Data pack/Gold prices.csv", 
                        colClasses = c(rep("Date", 1),
                                       rep("numeric", 2),
                                       rep("NULL", 4)),
                        col.names = c('Date',
                                      'Morning.Fix.USD',
                                      'Afternoon.Fix.USD',
                                      rep("NULL", 4)),
                        header = TRUE)
```

* uzupełnijnie brakujących wartości (NA) w kolumnach z ceną otwarcia i zamknięcia, wartością z sąsiedniej kolumny (w całym zbiorze nie ma sytuacji gdzie brakują obydwie)

```{r}
Gold.prices <- Gold.prices %>% 
  mutate(Morning.Fix.USD = coalesce(Morning.Fix.USD, Afternoon.Fix.USD)) %>%
  mutate(Afternoon.Fix.USD = coalesce(Afternoon.Fix.USD, Morning.Fix.USD)) 
```

#### Podsumowanie danych:

Zbiór zawiera codzienne wyceny złota podczas sesji otwarcia i zamknięcia od dnia 1968-01-02 do 2021-09-29.

```{r}
head(Gold.prices)
nrow(Gold.prices)
summary(Gold.prices)
```

#### Analiza wartości ceny złota

Na wykresie widzimy zmianę cen otwarcia w czasie.

```{r}
ggplot(Gold.prices, aes(x = Date)) +
  geom_point(aes(y = Morning.Fix.USD), color = "yellow")
```

***

> ### World development indicators

#### Wczytywanie zbioru danych

```{r}
World_Development_Indicators <- read_excel("C:/Users/alili/Desktop/studia/9 semestr/ZED/projekt/Data pack/World_Development_Indicators.xlsx", 
                                           na = '..', 
                                           range = "A1:BC44305")

unique(World_Development_Indicators$`Country Name`)
```

#### Czyszczenie zbioru:

* usunięcie elementów innych niż kraje z kolumny `Country Name`, pozostawienie całego swiata w zbiorze krajów, 

```{r}
World_Development_Indicators <- World_Development_Indicators %>%
  filter(!`Country Name` %in% c("Low & middle income","Low income","Lower middle income","Middle income","Upper middle income","High income"))
```


* wyodrębnienie kodów serii do osobnej tabeli oraz usunięcie jej z przetwarzanego zbioru,
* przeniesienie zmiennych do osobnych kolumn,

```{r}
World_Development_Indicators.Series_Codes <- select(World_Development_Indicators, `Series Name`, `Series Code`)
World_Development_Indicators <- select(World_Development_Indicators, -`Series Code`)
```

* przeniesienie pojedyńczych obserwacji do osobnych wierszy

```{r}
World_Development_Indicators <- World_Development_Indicators %>%
  pivot_longer(cols = `1970 [YR1970]`:`2020 [YR2020]`, names_to = "Year") %>%
  group_by(`Series Name`) %>%
  mutate(row = row_number()) %>%
  tidyr::pivot_wider(names_from = `Series Name`, values_from = value) %>%
  select(-row)
```

* poprawa kolumny Year: wyodrębnienie lat jako numerycznych wartości

```{r}
World_Development_Indicators <- World_Development_Indicators %>%
  mutate(Year = as.numeric(substr(Year, 1, 4)))
```

#### Podsumowanie danych:

Zbiór zawiera pierdyliard wskaźników - trzeba wybrać potrzebne.

```{r}
ncol(World_Development_Indicators)
nrow(World_Development_Indicators)
#summary(World_Development_Indicators)
```

***

> ### S&P Composite

#### Wczytywanie danych

```{r}
SP.Composite <- read.csv("C:/Users/alili/Desktop/studia/9 semestr/ZED/projekt/Data pack/S&P Composite.csv")
```

#### Czyszczenie danych:

* zmiana nazwy oraz typ na właściwy kolumny z datą
* zmiana nazwy Cyclicaly.Adjusted.PE.Ratio na skrót CAPE -

```{r}
SP.Composite <- SP.Composite %>%
  rename(Date = Year,
         CAPE = Cyclically.Adjusted.PE.Ratio) %>%
  mutate(Date = as.Date(Date))
```

#### Znaczenie atrybutów:

* S.P.Composite - nominalna wartość indexu,
* Divident - nominalna dywidenta,
* Earnings - nominalne zarobki na indeksie,
* CPI - wskaźnik cen towarów i usług konsumpcyjnych. Najpopularniejsza na świecie miara inflacji/deflacji,
* Long.Interest.Rate - stopy procentowe dziesięcioletnich obligacji rządowych,
* Real.Price - realna wartość indexu,
* Real.Divident - realna dywidenta,
* Real.Earnings - realne zarobki na indeksie,
* CAPE (Cyclicaly.Adjusted.PE.Ratio) - cyklicznie dostosowywany wskaźnik ceny do zysków. Definiuje się go jako cenę podzieloną przez średnią z dziesięciu lat zarobków, skorygowaną o inflację.

```{r}
SP.Composite %>%
  ggplot(aes(x=Date)) +
  geom_point(aes(y = S.P.Composite), color = "blue") +
  geom_point(aes(y = Real.Price), color = "red") +
  geom_point(aes(y = CPI), color = "yellow") +
  ylim(0, 1000)
```

#### Podsumowanie danych

```{r}
head(SP.Composite)
ncol(SP.Composite)
nrow(SP.Composite)
summary(SP.Composite)
```

***

> ### Currency Exchange Rates

#### Wczytywanie danych:

```{r, cache=TRUE}
Currency.Exchange.Rates <- read.csv("C:/Users/alili/Desktop/studia/9 semestr/ZED/projekt/Data pack/CurrencyExchangeRates.csv")
```

#### Czyszczenie danych:

* zmiana typu kolumny z datą

```{r}
Currency.Exchange.Rates <- Currency.Exchange.Rates %>% 
  mutate(Date = as.Date(Date))
```

#### Podsumowanie danych:

Zbiór zawiera codzienne wyceny złota podczas sesji otwarcia i zamknięcia od dnia 1968-01-02 do 2021-09-29.

```{r}
ncol(Currency.Exchange.Rates)
nrow(Currency.Exchange.Rates)
summary(Currency.Exchange.Rates)
```

***

> #### Analizy:

#### Interaktywny wykres zmiany liczby ludności w czasie:

```{}
World_Development_Indicators %>%
  group_by(Year) %>%
  summarise(`Country Name`, Year = 2000, `Urban population`) %>%
  arrange(`Urban population`, .by_group = T) %>%
  top_n(10)
  ggplot(aes(x = `Country Name`, y = `Urban population`)) +
  geom_col()
  
  ggplot(aes(x = `Country Name`, group = `Urban population`,fill=factor(`Urban population`)`)) +
  coord_flip() +
  geom_bar() +
  theme_minimal()



```

